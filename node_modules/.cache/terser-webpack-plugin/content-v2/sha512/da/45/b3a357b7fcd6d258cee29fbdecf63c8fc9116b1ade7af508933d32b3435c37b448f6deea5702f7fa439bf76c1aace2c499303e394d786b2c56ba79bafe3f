{"code":"!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=0)}([function(t,e,n){\"use strict\";n.r(e),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext.prototype.createNoise=function(){for(var t=this.createBufferSource(),e=this.createBuffer(1,Math.pow(2,12),this.sampleRate),n=e.getChannelData(0),i=0;i<n.length;i++)n[i]=2*Math.random(0)-1;return t.buffer=e,t.loop=!0,t};var i=[{name:\"noise\",defaultValue:0,minValue:-1,maxValue:1},{name:\"frequency\",defaultValue:140,minValue:0},{name:\"tenseness\",defaultValue:.6,minValue:0,maxValue:1},{name:\"intensity\",defaultValue:1,minValue:0,maxValue:1},{name:\"loudness\",defaultValue:1,minValue:0,maxValue:1},{name:\"tongueIndex\",defaultValue:12.9},{name:\"tongueDiameter\",defaultValue:2.43},{name:\"vibratoWobble\",defaultValue:1,minValue:0,maxValue:1},{name:\"vibratoFrequency\",defaultValue:6,minValue:0},{name:\"vibratoGain\",defaultValue:.005,minValue:0}];i.numberOfConstrictions=3;for(var r=0;r<i.numberOfConstrictions;r++){var o=[{name:\"constriction\"+r+\"index\",defaultValue:0,automationRate:\"k-rate\"},{name:\"constriction\"+r+\"diameter\",defaultValue:0,automationRate:\"k-rate\"}];i.push.apply(i,o)}var s=i;function a(t,e,n){return(a=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&h(r,n.prototype),r}).apply(null,arguments)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||\"[object Arguments]\"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}()}function l(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=t,this.y=e,this.z=n}function c(){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]].map(function(t){return a(l,u(t))}),this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(Math.pow(2,9)),this.gradP=new Array(Math.pow(2,9)),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6,this.seed(Date.now())}Object.defineProperties(l.prototype,{dot2:{value:function(t,e){return this.x*t+this.y*e}},dot3:{value:function(t,e,n){return this.dot2(t,e)+this.z*n}}}),Object.defineProperties(c.prototype,{seed:{value:function(t){t>0&&t<1&&(t*=Math.pow(2,16)),(t=Math.floor(t))<Math.pow(2,8)&&(t|=t<<Math.pow(2,3));for(var e=0;e<Math.pow(2,8);e++){var n=1&e?0:Math.pow(2,3),i=this.p[e]^t>>n&Math.pow(2,8)-1;this.perm[e]=this.perm[e+Math.pow(2,8)]=i,this.gradP[e]=this.gradP[e+Math.pow(2,8)]=this.grad3[i%this.grad3.length]}}},simplex2:{value:function(t,e){var n=(t+e)*this.F2,i=Math.floor(t+n),r=Math.floor(e+n),o=(i+r)*this.G2,s=t-i+o,a=e-r+o,h=s>a?1:0,u=1-h,l=s-h+this.G2,c=a-u+this.G2,f=s-1+2*this.G2,p=a-1+2*this.G2;i&=Math.pow(2,8)-1,r&=Math.pow(2,8)-1;var d=this.gradP[i+this.perm[r]],m=this.gradP[i+h+this.perm[r+u]],v=this.gradP[i+1+this.perm[r+1]],g=.5-Math.pow(s,2)-Math.pow(a,2),y=g<0?0:Math.pow(g,4)*d.dot2(s,a),b=.5-Math.pow(l,2)-Math.pow(c,2),w=b<0?0:Math.pow(b,4)*m.dot2(l,c),x=.5-Math.pow(f,2)-Math.pow(p,2);return 70*(y+w+(x<0?0:Math.pow(x,4)*v.dot2(f,p)))}},simplex1:{value:function(t){return this.simplex2(1.2*t,-.7*t)}}});var f=c;function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Math.clamp=function(t,e,n){return t<=e?e:t<n?t:n};var d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.noise=new f,this.coefficients={alpha:0,Delta:0,E0:0,epsilon:0,omega:0,shift:0,Te:0},this.startSeconds=0}var e,n,i;return e=t,(n=[{key:\"process\",value:function(t,e,n,i){var r=t.intensity,o=t.loudness,s=0;if(s+=t.vibratoGain*Math.sin(2*Math.PI*i*t.vibratoFrequency),s+=.02*this.noise.simplex1(4.07*i),s+=.04*this.noise.simplex1(2.15*i),t.vibratoWobble>0){var a=0;a+=.2*this.noise.simplex1(.98*i),s+=(a+=.4*this.noise.simplex1(.5*i))*t.vibratoWobble}var h=t.frequency;h*=1+s;var u=t.tenseness;u+=.1*this.noise.simplex1(.46*i),u+=.05*this.noise.simplex1(.36*i),u+=(3-u)*(1-r);var l=1/h,c=i-this.startSeconds,f=c/l;f>=1&&(this.startSeconds=i+c%l,f=this.startSeconds/l,this._updateCoefficients(u));var p=0,d=this._getNoiseModulator(f);d+=3*(1-u*r),t.noiseModulator=d;var m=t.noise;m*=d,m*=u,m*=r,m*=1-Math.sqrt(Math.max(u,0)),m*=.02*this.noise.simplex1(1.99*i)+.2;var v=this._getNormalizedWaveform(f);return p=m+(v*=o),p*=r}},{key:\"update\",value:function(){}},{key:\"_updateCoefficients\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e={};e.d=Math.clamp(3*(1-t),.5,2.7),e.a=.048*e.d-.01,e.k=.224+.118*e.d,e.g=e.k/4*(.5+1.2*e.k)/(.11*e.d-e.a*(.5+1.2*e.k));var n={};n.a=e.a,n.p=1/(2*e.g),n.e=n.p+n.p*e.k,this.coefficients.epsilon=1/n.a,this.coefficients.shift=Math.exp(-this.coefficients.epsilon*(1-n.e)),this.coefficients.Delta=1-this.coefficients.shift;var i={};i.RHS=(1/this.coefficients.epsilon*(this.coefficients.shift-1)+(1-n.e)*this.coefficients.shift)/this.coefficients.Delta,i.total={},i.total.lower=-(n.e-n.p)/2+i.RHS,i.total.upper=-i.total.lower,this.coefficients.omega=Math.PI/n.p;var r=Math.sin(this.coefficients.omega*n.e),o=-Math.PI*r*i.total.upper/(2*n.p),s=Math.log(o);this.coefficients.alpha=s/(n.p/2-n.e),this.coefficients.E0=-1/(r*Math.exp(this.coefficients.alpha*n.e)),this.coefficients.Te=n.e}},{key:\"_getNormalizedWaveform\",value:function(t){return t>this.coefficients.Te?(-Math.exp(-this.coefficients.epsilon*(t-this.coefficients.Te))+this.coefficients.shift)/this.coefficients.Delta:this.coefficients.E0*Math.exp(this.coefficients.alpha*t)*Math.sin(this.coefficients.omega*t)}},{key:\"_getNoiseModulator\",value:function(t){var e=2*Math.PI*t,n=Math.sin(e);return.2*Math.max(0,n)+.1}}])&&p(e.prototype,n),i&&p(e,i),t}();var m=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.tract=e,this.length=Math.floor(28*e.length/44),this.start=e.length-this.length+1,this.output=0,this.fade=1,this.offset=.8,this.left=new Float64Array(this.length),this.left.junction=new Float64Array(this.length+1),this.right=new Float64Array(this.length),this.right.junction=new Float64Array(this.length+1),this.reflection=new Float64Array(this.length+1),this.reflection.value=0,this.reflection.new=0,this.diameter=new Float64Array(this.length),this.amplitude=new Float64Array(this.length),this.amplitude.max=new Float64Array(this.length);for(var n=0;n<this.length;n++){var i=n/this.length,r=i<.5?.4+2*i*1.6:.5+1.5*(2-2*i);this.diameter[n]=Math.min(r,1.9)}this.diameter[0]=e.velum.target;for(var o=0;o<this.length;o++)this.amplitude[o]=Math.pow(this.diameter[o],2),o>0&&(this.reflection[o]=(this.amplitude[o-1]-this.amplitude[o])/(this.amplitude[o-1]+this.amplitude[o]))};function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var g=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.position=e,this.startTime=n,this.timeAlive=0,this.lifetime=.2,this.strength=.3,this.exponent=200}var e,n,i;return e=t,(n=[{key:\"update\",value:function(t){this.timeAlive=t-this.startTime}},{key:\"amplitude\",get:function(){return this.strength*Math.pow(-2,this.timeAlive*this.exponent)}},{key:\"isAlive\",get:function(){return this.timeAlive<this.lifetime}}])&&v(e.prototype,n),i&&v(e,i),t}();function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}Math.interpolate=function(t,e,n){return e*(1-t)+n*t},Math.clamp=function(t,e,n){return t<=e?e:t<n?t:n};var b=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:44;!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.length=e,this.blade={start:Math.floor(10*this.length/44)},this.tip={start:Math.floor(32*this.length/44)},this.lip={start:Math.floor(39*this.length/44),reflection:-.85},this.glottis={reflection:.75},this.velum={target:.01},this.grid={offset:1.7},this.tongue={_diameter:2.43,_index:12.9,range:{diameter:{minValue:2.05,maxValue:3.5,get range(){return this.maxValue-this.minValue},interpolation:function(t){var e=(t-this.minValue)/this.range;return Math.clamp(e,0,1)}},index:{minValue:this.blade.start+2,maxValue:this.tip.start-3,get range(){return this.maxValue-this.minValue},get center(){return(this.maxValue+this.minValue)/2},centerOffset:function(t){return t*this.range/2}}},get diameter(){return this._diameter},set diameter(t){this._diameter=Math.clamp(t,this.range.diameter.minValue,this.range.diameter.maxValue)},get index(){return this._index},set index(t){var e=1-this.range.diameter.interpolation(this.diameter),n=Math.pow(e,.58)-.2*(Math.pow(e,2)-e),i=this.range.index.centerOffset(n);this._index=Math.clamp(t,this.range.index.center-i,this.range.index.center+i)}},this.nose=new m(this),this.transients=[],this.transients.obstruction={last:-1,new:-1},this.previousConstrictions=[],this.previousConstrictions.tongue={},this.right=new Float64Array(this.length),this.right.junction=new Float64Array(this.length+1),this.right.reflection={value:0,new:0},this.left=new Float64Array(this.length),this.left.junction=new Float64Array(this.length+1),this.left.reflection={value:0,new:0},this.reflection=new Float64Array(this.length+1),this.reflection.new=new Float64Array(this.length+1),this.amplitude=new Float64Array(this.length),this.amplitude.max=new Float64Array(this.length),this.diameter=new Float64Array(this.length),this.diameter.rest=new Float64Array(this.length),this.diameter.target=new Float64Array(this.length),this.diameter.new=new Float64Array(this.length);for(var n=0;n<this.length;n++){var i=0;i=n<7*this.length/44-.5?.6:n<12*this.length/44?1.1:1.5,this.diameter[n]=i,this.diameter.rest[n]=i,this.diameter.target[n]=i,this.diameter.new[n]=i}this._updateDiameterRest();for(var r=0;r<this.length;r++)this.diameter[r]=this.diameter.rest[r],this.diameter.target[r]=this.diameter.rest[r];this._updateReflection()}var e,n,i;return e=t,(n=[{key:\"process\",value:function(t,e,n,i,r){this.tongue.diameter=t.tongueDiameter,this.tongue.index=t.tongueIndex,this._processTransients(i),this._processConstrictions(this.previousConstrictions,t);var o=e/n,s=Math.random()<.1;return this._processLips(t,o,s)}},{key:\"_processTransients\",value:function(t){for(var e=this.transients.length-1;e>=0;e--){var n=this.transients[e];this.left[n.position]+=n.amplitude,n.update(t),n.isAlive||this.transients.splice(e,1)}}},{key:\"_processConstrictions\",value:function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.index>=2&&i.index<=this.length&&i.diameter>0){var r=e.glottis;r*=.66*e.noiseModulator,r*=Math.clamp(8*(.7-i.diameter),0,1)*Math.clamp(30*(i.diameter-.3),0,1)/2;var o=Math.floor(i.index),s=r*(i.index-o),a=o+1,h=r*(a-i.index);this.right[o+1]+=s,this.right[a+1]+=h,this.left[o+1]+=s,this.left[a+1]+=h}}}},{key:\"_processLips\",value:function(t,e,n){this.right.junction[0]=this.left[0]*this.glottis.reflection+t.glottis,this.left.junction[this.length]=this.right[this.length-1]*this.lip.reflection;for(var i=1;i<this.length;i++){var r=Math.interpolate(e,this.reflection[i],this.reflection.new[i])*(this.right[i-1]+this.left[i]);this.right.junction[i]=this.right[i-1]-r,this.left.junction[i]=this.left[i]+r}var o=Math.interpolate(e,this.left.reflection.new,this.left.reflection.value);this.left.junction[this.nose.start]=o*this.right[this.nose.start-1]+(o+1)*(this.nose.left[0]+this.left[this.nose.start]);var s=Math.interpolate(e,this.right.reflection.new,this.right.reflection.value);this.right.junction[this.nose.start]=s*this.left[this.nose.start]+(s+1)*(this.nose.left[0]+this.right[this.nose.start-1]);for(var a=0;a<this.length;a++)if(this.right[a]=.999*this.right.junction[a],this.left[a]=.999*this.left.junction[a+1],n){var h=Math.abs(this.left[a]+this.right[a]);this.amplitude.max[a]=h>this.amplitude.max[a]?h:.999*this.amplitude.max[a]}return this.right[this.length-1]}},{key:\"_processNose\",value:function(t,e,n){this.nose.left.junction[this.nose.length]=this.nose.right[this.nose.length-1]*this.lip.reflection;var i=Math.interpolate(e,this.nose.reflection.new,this.nose.reflection.value);this.nose.right.junction[0]=i*this.nose.left[0]+(i+1)*(this.left[this.nose.start]+this.right[this.nose.start-1]);for(var r=1;r<this.nose.length;r++){var o=this.nose.reflection[r]*(this.nose.left[r]*this.nose.right[r-1]);this.nose.left.junction[r]=this.nose.left[r]+o,this.nose.right.junction[r]=this.nose.right[r-1]-o}for(var s=0;s<this.nose.length;s++)if(this.nose.left[s]=this.nose.left.junction[s+1]*this.nose.fade,this.nose.right[s]=this.nose.right.junction[s]*this.nose.fade,n){var a=Math.abs(this.nose.left[s]+this.nose.right[s]);this.nose.amplitude.max[s]=a>this.nose.amplitude.max[s]?a:.999*this.nose.amplitude.max[s]}return this.nose.right[this.nose.length-1]}},{key:\"update\",value:function(t,e){this._updateDiameterRest(),this._updateConstrictions(e),this._updateTract(),this._updateTransients(t),this.nose.diameter[0]=this.velum.target,this.nose.amplitude[0]=Math.pow(this.nose.diameter[0],2),this._updateReflection()}},{key:\"_updateDiameterRest\",value:function(){for(var t=this.blade.start;t<this.lip.start;t++){var e=(this.tongue.index-t)/(this.tip.start-this.blade.start),n=1.1*Math.PI*e,i=(1.5-(2+(this.tongue.diameter-2)/1.5)+this.grid.offset)*Math.cos(n);t!=this.blade.start-2&&t!=this.lip.start-1||(i*=.8),t!=this.blade.start+0&&t!=this.lip.start-2||(i*=.94);var r=1.5-i;this.diameter.rest[t]=r}}},{key:\"_updateConstrictions\",value:function(t){var e=!1;e=e||this.tongue.index!==this.previousConstrictions.tongue.index||this.tongue.diameter!==this.previousConstrictions.tongue.diameter;for(var n=Math.max(this.previousConstrictions.length,t.length),i=0,r=t[0],o=this.previousConstrictions[0];!e&&i<n;r=t[++i],o=this.previousConstrictions[i])e=void 0!==r&&void 0!==o?r.index!==o.index||r.diameter!==o.diameter:!(null==r&&null==o);if(e){console.log(\"update\");for(var s=0;s<this.length;s++)this.diameter.target[s]=this.diameter.rest[s];this.velum.target=.01;for(var a=-1;a<t.length;a++){var h=t[a]||this.tongue;if(h.index>this.nose.start&&h.diameter<-this.nose.offset&&(this.velum.target=.4),h.index>=2&&h.index<this.length&&h.diameter>-(.85+this.nose.offset)){var u=h.diameter;if(u-=.3,(u=Math.max(0,u))<3){var l=2;l=h.index<25?10:h.index>=this.tip.start?5:10-5*(h.index-25)/(this.tip.start-25);for(var c=Math.round(h.index),f=Math.ceil(l)+1,p=c-f;p<c+f&&p>=0&&p<this.length;p++){var d,m=Math.abs(p-h.index)-.5;d=m<=0?0:m<=l?.5*(1-Math.cos(Math.PI*m/l)):1;var v=this.diameter.target[p]-u;v>0&&(this.diameter.target[p]=u+v*d)}}}}this.previousConstrictions=t,this.previousConstrictions.tongue={index:this.tongue.index,diameter:this.tongue.diameter}}}},{key:\"_updateTract\",value:function(){for(var t=0;t<this.length;t++){this.diameter[t]<=0&&(this.transients.obstruction.new=t),t<this.nose.start?.6:t>=this.tip.start?1:.6+.4*(t-this.nose.start),this.diameter[t]=this.diameter.target[t]}}},{key:\"_updateTransients\",value:function(t){this.nose.amplitude[0]<.05&&(this.transients.obstruction.last>-1&&-1==this.transients.obstruction.new&&this.transients.push(new g(this.transients.obstruction.new,t)),this.transients.obstruction.last=this.transients.obstruction.new)}},{key:\"_updateReflection\",value:function(){for(var t=0;t<this.length;t++)this.amplitude[t]=Math.pow(this.diameter[t],2),t>0&&(this.reflection[t]=this.reflection.new[t],this.reflection.new[t]=0==this.amplitude[t]?.999:(this.amplitude[t-1]-this.amplitude[t])/(this.amplitude[t-1]+this.amplitude[t]));var e=this.amplitude[this.nose.start]+this.amplitude[this.nose.start+1]+this.nose.amplitude[0];this.left.reflection.value=this.left.reflection.new,this.left.reflection.new=(2*this.amplitude[this.nose.start]-e)/e,this.right.reflection.value=this.right.reflection.new,this.right.reflection.new=(2*this.amplitude[this.nose.start+1]-e)/e,this.nose.reflection.value=this.nose.reflection.new,this.nose.reflection.new=(2*this.nose.amplitude[0]-e)/e}}])&&y(e.prototype,n),i&&y(e,i),t}();function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var x=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.glottis=new d,this.tract=new b}var e,n,i;return e=t,(n=[{key:\"process\",value:function(t,e,n,i,r){var o,s,a=0,h=(o=this.glottis).process.apply(o,arguments);return t.glottis=h,a+=(s=this.tract).process.apply(s,arguments),e=.5,a+=this.tract.process(t,.5,n,i,r)}},{key:\"update\",value:function(t,e){this.glottis.update(),this.tract.update(t,e)}}])&&w(e.prototype,n),i&&w(e,i),t}();function M(t){return(M=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function k(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}function C(t){var e=\"function\"==typeof Map?new Map:void 0;return(C=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf(\"[native code]\")))return t;var n;if(\"function\"!=typeof t)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return P(t,arguments,j(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),T(i,t)})(t)}function P(t,e,n){return(P=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&T(r,n.prototype),r}).apply(null,arguments)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function A(t){t._constrictions=[];for(var e=function(e){t._constrictions[e]={index:null,diameter:null,_enable:function(){return t._enableConstriction(e)},_disable:function(){return t._disableConstriction(e)},_isEnabled:!1}},n=0;n<s.numberOfConstrictions;n++)e(n);t.newConstriction=function(){return this._constrictions.find(function(t){if(!t._isEnabled)return t._enable(),!0})},t.removeConstriction=function(t){t._disable()},Object.defineProperty(t,\"constrictions\",{get:function(){return this._constrictions.filter(function(t){return t._isEnabled})}}),t.tongue={index:null,diamter:null},t.vibrato={frequency:null,gain:null,wobble:null}}function O(t,e,n){if(n.includes(\"constriction\")){var i=Number(n.match(/[0-9]+/g)[0]),r=t._constrictions[i];r[n.includes(\"index\")?\"index\":\"diameter\"]=e,t.constrictions[i]=r}else n.includes(\"vibrato\")?t.vibrato[n.replace(\"vibrato\",\"\").toLowerCase()]=e:n.includes(\"tongue\")?t.tongue[n.replace(\"tongue\",\"\").toLowerCase()]=e:t[n]=e}if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioWorklet){var F=function(t){function e(t){var n,i,r;return function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,e),i=this,r=j(e).call(this,t,\"pink-trombone-worklet-processor\"),n=!r||\"object\"!==M(r)&&\"function\"!=typeof r?_(i):r,A(_(n)),n.parameters.forEach(function(t,e){O(_(n),t,e)}),n.port.onmessage=function(t){t.data.name},n}var n,i,r;return function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(e,C(AudioWorkletNode)),n=e,(i=[{key:\"_postMessage\",value:function(t){var e=this;return t.id=Math.random(),new Promise(function(n,i){e.port.addEventListener(\"message\",function i(r){t.id==Number(r.data.id)&&(e.port.removeEventListener(\"message\",i),n(r))}),e.port.postMessage(t)})}},{key:\"_enableConstriction\",value:function(t){var e=this;return this._postMessage({name:\"enableConstriction\",constrictionIndex:t}).then(function(){e._constrictions[t]._isEnabled=!0})}},{key:\"_disableConstriction\",value:function(t){var e=this;return this._postMessage({name:\"disableConstriction\",constrictionIndex:t}).then(function(){e._constrictions[t]._isEnabled=!1})}}])&&k(n.prototype,i),r&&k(n,r),e}();window.AudioContext.prototype.createPinkTromboneNode=function(){return P(F,[this].concat(Array.prototype.slice.call(arguments)))}}else window.AudioContext.prototype.createPinkTromboneNode=function(){var t=this,e=this.createScriptProcessor(Math.pow(2,12),s.length,1);return e.processor=new x,A(e),e.channelMerger=this.createChannelMerger(s.length),e.channelMerger.channels=[],e.channelMerger.connect(e),s.forEach(function(n,i){var r=t.createConstantSource();r.start();var o=r.offset;o.automationRate=n.automationRate||\"a-rate\",o.value=n.defaultValue||0,r.connect(e.channelMerger,0,i),e.channelMerger.channels[i]=n.name,O(e,o,n.name)}),e._getParameterChannels=function(t){for(var e={},n=0;n<t.numberOfChannels;n++)e[this.channelMerger.channels[n]]=t.getChannelData(n);return e},e._getParameterSamples=function(t,e){for(var n={},i=Object.keys(t),r=0;r<i.length;r++){var o=i[r];o.includes(\"constriction\")||(n[o]=t[o][e])}return n},e._getConstrictions=function(t){for(var e=[],n=0;n<this._constrictions.length;n++){if(this._constrictions[n]._isEnabled){var i={index:t[\"constriction\"+n+\"index\"][0],diameter:t[\"constriction\"+n+\"diameter\"][0]};e[n]=i}}return e},e.onaudioprocess=function(t){for(var e=t.outputBuffer.getChannelData(0),n=this._getParameterChannels(t.inputBuffer),i=this._getConstrictions(n),r=0;r<e.length;r++){var o=this._getParameterSamples(n,r),s=e.length,a=t.playbackTime+r/t.inputBuffer.sampleRate;e[r]=this.processor.process(o,r,s,a,i)}this.processor.update(t.playbackTime+e.length/t.inputBuffer.sampleRate,i)},e._enableConstriction=function(t){this._constrictions[t]._isEnabled=!0},e._disableConstriction=function(){this._constrictions[constrictionIndex]._isEnabled=!1},e};function V(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function E(t,e,n){return e&&V(t.prototype,e),n&&V(t,n),t}window.AudioContext=window.AudioContext||window.webkitAudioContext;var S=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.loadPromise=this.addModules(e).then(function(){return n.audioContext=e,n.setupAudioGraph(),n.audioContext})}return E(t,[{key:\"addModules\",value:function(t){return void 0!==t.audioWorklet?Promise.all([t.audioWorklet.addModule(\"/script/audio/nodes/noise/processors/workletProcessors/WorkletProcessor.js\"),t.audioWorklet.addModule(\"/script/audio/nodes/pinkTrombone/processors/workletProcessors/WorkletProcessor.js\")]):new Promise(function(t){t()})}}]),E(t,[{key:\"setupAudioGraph\",value:function(){this.noise=this.audioContext.createNoise(),this.aspirateFilter=this.audioContext.createBiquadFilter(),this.aspirateFilter.type=\"bandpass\",this.aspirateFilter.frequency.value=500,this.aspirateFilter.Q.value=.5,this.fricativeFilter=this.audioContext.createBiquadFilter(),this.fricativeFilter.type=\"bandpass\",this.fricativeFilter.frequency.value=1e3,this.fricativeFilter.Q.value=.5,this.pinkTromboneNode=this.audioContext.createPinkTromboneNode(),this.noise.connect(this.aspirateFilter),this.aspirateFilter.connect(this.pinkTromboneNode.noise),this.noise.connect(this.fricativeFilter),this.fricativeFilter.connect(this.pinkTromboneNode.noise)}},{key:\"connect\",value:function(){var t;return(t=this.pinkTromboneNode).connect.apply(t,arguments)}},{key:\"disconnect\",value:function(){var t;return(t=this.pinkTromboneNode).disconnect.apply(t,arguments)}},{key:\"start\",value:function(){this.noise.start()}},{key:\"stop\",value:function(){this.noise.stop()}},{key:\"newConstriction\",value:function(){var t;return(t=this.pinkTromboneNode).newConstriction.apply(t,arguments)}},{key:\"removeConstriction\",value:function(t){this.pinkTromboneNode.removeConstriction(t)}}]),t}();window.AudioContext.prototype.createPinkTrombone=function(){return new S(this)};function R(t){return(R=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function D(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,\"value\"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function N(t,e){return!e||\"object\"!==R(e)&&\"function\"!=typeof e?function(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}(t):e}function q(t){var e=\"function\"==typeof Map?new Map:void 0;return(q=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf(\"[native code]\")))return t;var n;if(\"function\"!=typeof t)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return I(t,arguments,G(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),W(i,t)})(t)}function I(t,e,n){return(I=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&W(r,n.prototype),r}).apply(null,arguments)}function W(t,e){return(W=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var B=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,e),t=N(this,G(e).call(this)),window.customElements.whenDefined(\"pink-trombone\").then(function(){var e=new Event(\"load\");t.dispatchEvent(e)}),t}var n,i,r;return function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&W(t,e)}(e,q(HTMLElement)),n=e,r=[{key:\"observedAttributes\",get:function(){return[]}}],(i=[{key:\"attributeChangedCallback\",value:function(t,e,n){t}},{key:\"setAudioContext\",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new window.AudioContext;return this.pinkTrombone=e.createPinkTrombone(),this.loadPromise=this.pinkTrombone.loadPromise.then(function(e){return t.pinkTrombone}),this.loadPromise}},{key:\"connect\",value:function(){var t;if(this.pinkTrombone)return(t=this.pinkTrombone).connect.apply(t,arguments)}},{key:\"disconnect\",value:function(){var t;if(this.pinkTrombone)return(t=this.pinkTrombone).disconnect.apply(t,arguments)}},{key:\"start\",value:function(){if(this.pinkTrombone)return this.pinkTrombone.start();throw\"Pink Trombone hasn't been set yet\"}},{key:\"stop\",value:function(){if(this.pinkTrombone)return this.pinkTrombone.stop();throw\"Pink Trombone hasn't been set yet\"}},{key:\"audioContext\",get:function(){if(this.pinkTrombone)return this.pinkTrombone.audioContext;throw\"Audio Context has not been set\"},set:function(t){this.setAudioContext(t)}}])&&D(n.prototype,i),r&&D(n,r),e}();document.createElement(\"pink-trombone\").constructor==HTMLElement&&window.customElements.define(\"pink-trombone\",B);e.default=B}]);","extractedComments":[]}